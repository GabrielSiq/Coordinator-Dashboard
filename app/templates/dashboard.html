{% extends "base.html" %}

{% block css %}
    <link href="{{ url_for('static', filename='assets/css/bootstrap-combobox.css')}}" rel="stylesheet" type='text/css'/>
{% endblock css %}

{% block content %}
    <div class="row">
        <div class="col-md-4">
            <div class="card">
                <div class="header">
                    <h4 class="title">Drop Rate <span class="glyphicon glyphicon-triangle-bottom"/></h4>
                    <p class="category">Courses with <span style="color: green; font-weight: bold">smallest</span> drop rate.</p>
                </div>
                <div class="content table-responsive table-full-width">
                    <table class="table table-hover table-striped">
                        <tbody>
                            {% for row in canc.iteritems() %}
                                <tr>
                                    <td>{{ row[0] }}</td>
                                    <td>{{ (row[1] * 100)|round(1) }}%</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="header">
                    <h4 class="title">Drop Rate <span class="glyphicon glyphicon-triangle-top"/></h4>
                    <p class="category">Courses with <span style="color: red; font-weight: bold">largest</span> drop rate.</p>
                </div>
                <div class="content table-responsive table-full-width">
                    <table class="table table-hover table-striped">
                        <tbody>
                            {% for row in canc2.iteritems() %}
                                <tr>
                                    <td>{{ row[0] }}</td>
                                    <td>{{ (row[1] * 100)|round(1) }}%</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            {% set canc3 = getDataTable(1) %}
            <div class="card">
                <div class="header">
                    <h4 class="title">Drop Rate <span class="glyphicon glyphicon-triangle-top"/></h4>
                    {# TODO: Dynamic styles for smalles/largest tags #}
                    <p class="category">Courses with <span id="{{ canc3.sort }}">{{ canc3.sort }}</span> drop rate.</p>
                </div>
                <div class="content table-responsive table-full-width">
                    <table class="table table-hover table-striped">
                        <tbody>

                            {% for row in canc3['data'].iteritems() %}
                                <tr>
                                    <td>{{ row[0] }}</td>
                                    <td>{{ (row[1] * 100)|round(1) }}%</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-2">
            <div class="card">
                <div class="header">
                    <h4 class="title">Empty Card</h4>
                    <p class="category">Sample sub heading</p>
                </div>
                <div class="content">
                    <p>Number of students with </p>
                </div>
            </div>
        </div>
        <div class="col-md-10">
            <div class="card" id="enrollment">
                <div class="header">
                    <h4 class="title">Enrollment Numbers</h4>
                    <p class="category">Number of students by course by year</p>
                </div>
                <div class="query-controls">
                    <form>
                        <select name="queryName">
                            <option>No saved query</option>
                        </select>
                    </form>
                </div>
                <div class="content">
                    <form>
                        <select id="matr" class="combobox">
                            <option></option>
                            <option value='AGB1488'>AGB1488</option>
                            <option value='GNR1825'>GNR1825</option>
                            <option value='WRC1627'>WRC1627</option>
                            <option value='HBF1988'>HBF1988</option>
                            <option value='UAM1180'>UAM1180</option>
                         </select>
                    </form>
                    <div id="ajax">

                    </div>
                    <div id="chartLine" class="ct-chart">

                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-2">
            <div class="card">
                <div class="header">
                    <h4 class="title">Empty Card</h4>
                    <p class="category">Sample sub heading</p>
                </div>
                <div class="content">
                    <p>Number of students with </p>
                </div>
            </div>
        </div>
        <div class="col-md-10">
            <div class="card" id="enrollment-2">
                <div class="header">
                    <h4 class="title">Enrollment Numbers</h4>
                    <p class="category">Number of students by course by year</p>
                </div>
                <div class="query-controls">
                    <form>
                        <select name="queryName">
                            <option>No saved query</option>
                        </select>
                    </form>
                </div>
                <div class="content">
                    <form>
                        <select id="matr" class="combobox">
                            <option></option>
                            <option value='AGB1488'>AGB1488</option>
                            <option value='GNR1825'>GNR1825</option>
                            <option value='WRC1627'>WRC1627</option>
                            <option value='HBF1988'>HBF1988</option>
                            <option value='UAM1180'>UAM1180</option>
                         </select>
                    </form>
                    <div id="ajax">

                    </div>
                    <div id="chartLine2" class="ct-chart">

                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-4">
            <div class="card">
                <div class="header">
                    <h4 class="title">Sample Pie Chart</h4>
                    <p class="category">This uses <a target="_blank" href="https://gionkunz.github.io/chartist-js/">Chartist.js</a></p>
                </div>
                <div class="content">
                    <div id="chartPreferences" class="ct-chart ct-perfect-fourth">

                    </div>

                    <div class="footer">
                        <div class="legend">
                            <i class="fa fa-circle text-info"></i> Slice 1
                            <i class="fa fa-circle text-danger"></i> Slice 2
                            <i class="fa fa-circle text-warning"></i> Slice 3
                        </div>
                        <hr>
                        <div class="stats">
                            <i class="fa fa-clock-o"></i> Timestamp for graph update info
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-8">
            <div class="card">
                <div class="header">
                    <h4 class="title">Sample Area Chart</h4>
                    <p class="category">Also using <a target="_blank" href="https://gionkunz.github.io/chartist-js/">Chartist.js</a></p>
                </div>
                <div class="content">
                    <div id="chartHours" class="ct-chart">

                    </div>
                    <div class="footer">
                        <div class="legend">
                            <i class="fa fa-circle text-info"></i> Line 1
                            <i class="fa fa-circle text-danger"></i> Line 2
                            <i class="fa fa-circle text-warning"></i> Line 3
                        </div>
                        <hr>
                        <div class="stats">
                            <i class="fa fa-history"></i> Same thing...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <div class="row">
        <div class="col-md-12">
            <div class="card ">
                <div class="header">
                    <h4 class="title">Sample Bar Chart</h4>
                    <p class="category">Chartist is good for simple, good looking, responsive charts. We can use others also...</p>
                </div>
                <div class="content">
                    <div id="chartActivity" class="ct-chart">

                    </div>

                    <div class="footer">
                        <div class="legend">
                            <i class="fa fa-circle text-info"></i> Category 1
                            <i class="fa fa-circle text-danger"></i> Category 2
                        </div>
                        <hr>
                        <div class="stats">
                            <i class="fa fa-check"></i> Same thing...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock content %}

{% block scripts %}
{#    <script src="{{ url_for('static', filename='assets/js/bootstrap-combobox.js')}}" type="text/javascript"></script>#}
{#    <script type="text/javascript">#}
{#      $(document).ready(function(){#}
{#        $('.combobox').combobox();#}
{#      });#}
{#    </script>#}
    <script>
        function updateChart(val, chartId) {
            console.log(val);
            console.log(chartId);
             $.ajax({
                type: "POST",
                url: "/rand",
                contentType:"application/json",
                data : JSON.stringify({'course': val}),
                success: function(resultJSON) {
                    var teste = JSON.parse(resultJSON)
                    var data = {
                      labels: teste['labels'],
                      series: [teste['series']]
                    };
                    var options = {
                        lineSmooth: false
                    };
                    new Chartist.Line("#" + chartId, data, options);
                },
                error: function() {
                    alert('error');
                }
            });
        }
    </script>
    <script>
        $(document).ready(function(){
            $("div.query-controls").each(function() {
                var controls = $(this);
                var comboBox;
                $.ajax({
                    type: "POST",
                    url: "/savedQueries",
                    contentType: "application/json",
                    data: JSON.stringify({'view_id': controls.parent().attr("id")}),
                    success: function(resultJSON) {

                        var savedQuery = JSON.parse(resultJSON);
                        var queryName = controls.find("select[name='queryName']");
                        queryName.append($('<option>', {
                            value: savedQuery.id,
                            text: savedQuery.name
                        }));
                        queryName.val(savedQuery.id);
                        $.each(savedQuery["data"], function(field, value){
                            comboBox = controls.parent().find(".content select#" + field);
                            comboBox.val(value);
                        });

                        updateChart(comboBox.val(), comboBox.parent().siblings("div.ct-chart").attr("id"))
                    },
                    error: function(){
                        alert("error");
                    }
                });
            });
        });
    </script>
    <script>
        $("select.combobox").change(function(e) {
            e.preventDefault();
            updateChart($(this).value, $(this).parent().siblings("div.chart-ct").attr("id") );
        });

    </script>
{% endblock scripts %}